# Building a Markdown summary of Django group permissions

[Django SQL Dashboard](https://django-sql-dashboard.datasette.io/) can display rendered markdown generated by a SQL query.

Here's a query I figured out today for showing a summary of all Django groups, their members and the list of permissions those groups hold:

```sql
select
  (
    '# ' || (
      select
        name
      from
        auth_group
      where
        id = auth_group_original.id
    ) || '

' || (
      select
        count(*)
      from
        auth_user_groups
      where
        auth_user_groups.group_id = auth_group_original.id
    ) || ' members:

' || (
      select
        string_agg(auth_user.username, ', ')
      from
        auth_user
        join auth_user_groups on auth_user_groups.user_id = auth_user.id
      where
        auth_user_groups.group_id = auth_group_original.id
    ) || '

Permissions: 

' || (
      select
        coalesce(
          string_agg(
            '* ' || auth_permission.name,
            '
'
          ),
          'None'
        )
      from
        auth_permission
        join auth_group_permissions on auth_group_permissions.permission_id = auth_permission.id
      where
        auth_group_permissions.group_id = auth_group_original.id
    )
  ) as markdown
from
  auth_group auth_group_original
```
The output looks like this:

<img width="473" alt="Groups_and_permissions" src="https://user-images.githubusercontent.com/9599/120677616-1ee7d300-c44c-11eb-95c6-ca5053338621.png">
